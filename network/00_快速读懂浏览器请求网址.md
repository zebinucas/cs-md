# 网络通信基础知识

## OSI七层模型和四层模型

### 七层模型

七层模型是理论上的规范

- 应用层        HTTP\FTP\Telnet\SNMP\DNS等
- 表示层        JPEG\ASCII\DECOIC\加密格式等
- 会话层        SSL\TLS等
- 传输层        TCP\UDP
- 网络层        IP\ICMP\ARP\RIP等
- 数据链路层    FDDI\Ethernet\PPP
- 物理层        IEEE802.1\IEEE802.2-802.11

### 四/五层模型

四/五层模型是实际使用的规范

- 应用层 -> 应用层|表示层|会话层
- 传输层 -> 传输层
- 网络层 -> 网络层
- 网络接口层(或者叫数据链路层) -> 数据链路层|物理层

有时候会把网络接口层分开称为数据链路层和物理层

## 浏览器输入网址返回页面的过程

1. 浏览器处理输入的网址
    1. 输入`www.baidu.com`这个网址
    2. `www.baidu.com`称作域名，只是方便记忆的字符串
    3. 域名会绑定到一个ip地址例如`192.168.0.1`
    4. 浏览器的缓存会检查是否存在域名对应的ip地址
    5. 如果没有缓存则会查找本地的hosts文件查看是否有映射关系
2. 应用层处理未知的域名
    1. 如果hosts文件中也没有就会将域名发送给电脑中存储的DNS服务器
    2. DNS是应用层协议，用于获取域名绑定的IP地址
    3. 通过DNS协议会构造一个请求(含义例如:获取`www.baidu.com`对应IP地址)
3. DNS请求处理过程
    1. DNS协议构造好请求向下传递到传输层
    2. 传输层包装请求添加上(源端口|目标端口|请求数据段)
    3. DNS目标端口默认53(请求发起的源端口|53|请求数据段)
    4. 继续向下将请求传递到网络层，网络层给请求数据继续添加proto
    6. (源IP 例`192.168.1.0`|目标IP 例`8.8.8.8`|源端口|DNS目标端口53|请求数据段)
    7. 封装之后发现目标IP不在网段范围之内，将请求转发到网关
    8. 家庭使用的网关一般是路由器
    9. 数据链路层给请求加上网关的MAC地址和源MAC地址
    10. (源MAC地址|目标MAC地址|网络层数据段)
    11. 然后请求到达物理层的网卡接口，从网线发出，达到交换机
4. 交换机解析数据报
    1. 交换机只能解析数据链路层和物理层的数据，更上层协议无法解析
    2. 交换机将数据报解析两层转发到路由器
5. 路由器解析数据报
    1. 路由器是三层设备，可以解析到网络层
    2. 路由器对应到交换机上传的数据报，检索到路由器的MAC地址和目标MAC地址对应
    3. 路由器解析后切掉目标MAC地址，网络层解析目标IP地址 例`8.8.8.8`还是找不到
    4. 由路由器继续转发数据报，一般路由器会设置默认路由，再转发到公网路由
    5. 路由器的端口分为WAN口和LAN口，WAN口有通往公网的IP地址，例`20.20.20.20`
    6. 路由器还会对源IP地址做NAT映射表地址转换为可以在公网上传播的公网IP
    7. 然后再加上源MAC地址和目标MAC地址(下一跳的路由器的MAC地址)
    8. 数据报从家用路由器的WAN口发出，传向公网的路由器
    9. 经过路由器的多次转发最终到达DNS服务器
10. DNS服务器处理数据报
    1. DNS服务器可以解析到应用层协议
    2. DNS服务器的DNS应用对层层上传解析的数据报进行解析并响应
    3. 重新封装响应一层层封装开始往回传
    4. 一层层从路由跳回源主机
11. 层层返回到到应用层浏览器获得了`www.baidu.com`的IP地址，重新构造一个请求
12. 通过相同的方式将请求发到目标服务器获取响应
13. 浏览器解析获取到的响应


